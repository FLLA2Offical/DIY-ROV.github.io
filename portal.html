<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team 69309 Portal</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
<style>
:root {
  --primary-blue: #0a0f1e;
  --accent-orange: #e46d0d;
  --text-light: #fff;
}
* { box-sizing: border-box; margin:0; padding:0; font-family: 'Segoe UI', sans-serif; }
body { background: var(--primary-blue); color: var(--text-light); overflow-x:hidden; padding-top:160px; }

/* Fixed Menu Bar */
nav.subnav {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    z-index:1002;
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    background: #11376b;
    padding:12px 0;
    box-shadow:0 0 20px rgba(20,20,60,0.8);
}
nav.subnav button {
    background: #11376b;
    border:2px solid var(--accent-orange);
    color: var(--accent-orange);
    padding:12px 20px;
    margin:5px 10px;
    font-weight:bold;
    cursor:pointer;
    border-radius:12px;
    transition:0.3s;
}
nav.subnav button:hover { color:#fff; box-shadow:0 0 20px var(--accent-orange),0 0 40px #11376b; transform:scale(1.05); }

/* Header */
header {
  background: linear-gradient(90deg, #11376b, var(--accent-orange));
  padding:50px 20px 20px 20px;
  text-align:center;
  font-size:2em;
  font-weight:bold;
  text-shadow:0 0 15px rgba(255,255,255,0.5);
  position: relative;
  border-radius:15px;
  margin-bottom:20px;
}
header img { border-radius:10px; margin:0 10px; height:80px; vertical-align: middle; }
header h1 { margin-top:10px; font-size:1.8em; }

/* Main content */
main { margin:0 auto; padding:20px; min-height:calc(100vh - 160px); max-width:1000px; }

/* Pages */
.page { display:none; background: rgba(17,55,107,0.4); border-radius:15px; padding:40px 20px; margin:20px auto; box-shadow:0 0 30px rgba(17,55,107,0.6); transition: transform 0.3s, box-shadow 0.3s; }
.page:hover { transform: translateY(-10px) scale(1.02); box-shadow:0 0 50px var(--accent-orange),0 0 100px #11376b; }
h2 { color:var(--accent-orange); font-size:2em; margin-bottom:20px; text-shadow:0 0 10px var(--accent-orange); }
p { font-size:1.1em; line-height:1.8em; color:#ccc; }

/* Buttons & Inputs */
input[type="file"], .webcam-btn, .reset-button, button { border:none; border-radius:6px; padding:10px 20px; background: var(--accent-orange); color:var(--text-light); cursor:pointer; margin:5px; transition:0.3s; }
input[type="file"]:disabled, .webcam-btn[disabled] { background:#888; cursor:not-allowed; }
input[type="color"] { margin:10px; padding:5px; border-radius:5px; border:none; cursor:pointer; }

img, video, canvas { border:4px solid var(--accent-orange); border-radius:10px; max-width:90%; margin:15px auto; display:block; }
.bar-container { width:90%; max-width:350px; margin:6px auto; background:#222; border-radius:8px; overflow:hidden; }
.bar { height:20px; text-align:left; padding-left:8px; line-height:20px; color:#fff; font-size:0.9em; background:var(--accent-orange); transition: width 0.3s ease; }
.spinner { border:6px solid #111; border-top:6px solid var(--accent-orange); border-radius:50%; width:40px; height:40px; animation: spin 1s linear infinite; margin:20px auto; display:none; }
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

/* Gradient preview */
#gradientPreview { width:80%; height:150px; margin:20px auto; border:3px solid var(--accent-orange); border-radius:10px; background: linear-gradient(90deg,#11376b,var(--accent-orange)); }

/* Chat Page */
#chatContainer { width:100%; height:calc(100vh - 20px); overflow-y:auto; }
#chatContainer iframe { width:100%; height:100%; border:none; }

footer { background:#001a3d; color:#888; text-align:center; padding:12px; margin-top:40px; font-size:0.9em; }

.open-chat-button {
  background: linear-gradient(135deg, #007BFF, var(--accent-orange));
  color: white; border-radius: 12px; padding: 12px 24px;
  font-weight: 600; box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  transition: all 0.3s ease; display:block; margin:20px auto;
}
.open-chat-button:hover { transform: translateY(-2px); box-shadow:0 6px 14px rgba(0,0,0,0.25);}
</style>
</head>
<body>

<nav class="subnav">
  <button onclick="showPage('objectPage')">Object Identifier</button>
  <button onclick="showPage('rockPage')">Rock Identifier</button>
  <button onclick="showPage('colorPage')">Change Color</button>
  <button onclick="showPage('chatPage')">Team Chat</button>
</nav>

<header id="mainHeader">
  <div>
    <img src="2023_Collegiate_School_Logo_1_A1.1.webp">
    <img src="69309logo.png">
  </div>
  Team 69309 Portal
</header>

<main id="mainContent">

<!-- Object Identifier -->
<div class="page" id="objectPage">
  <h2>Object Identifier</h2>
  <p>Upload an image or use your webcam:</p>
  <input id="objFile" type="file" accept="image/*" onchange="loadObjectImage(event)" disabled>
  <button class="reset-button" id="objReset" onclick="resetObject()" disabled>Reset</button>
  <br>
  <img id="objImage" alt="Uploaded Preview">
  <div class="spinner" id="objSpinner"></div>
  <div class="webcam-controls">
    <button id="objStart" class="webcam-btn" onclick="startObjectWebcam()" disabled>Start Webcam</button>
    <button id="objStop" class="webcam-btn" onclick="stopObjectWebcam()" disabled>Stop Webcam</button>
    <button id="objSwitch" class="webcam-btn" onclick="switchObjectCamera()" disabled>Switch Camera</button>
    <video id="objWebcam" playsinline autoplay muted></video>
    <div id="objLiveBadge">Live classification runningâ€¦</div>
  </div>
  <div id="objResult" aria-live="polite">Loading AI model...</div>
</div>

<!-- Rock Identifier -->
<div class="page" id="rockPage">
  <h2>Rock Identifier</h2>
  <p>Upload image or use webcam:</p>
  <input id="rockFile" type="file" accept="image/*" onchange="loadRockImage(event)">
  <div id="rockStatus"></div>
  <div id="rockWebcamContainer"></div>
  <div id="rockLabelContainer"></div>
  <img id="rockImage" alt="Uploaded Preview">
  <button onclick="startRockWebcam()">Start Webcam</button>
  <button onclick="switchRockCamera()">Switch Camera</button>
  <button onclick="stopRockWebcam()">Stop Webcam</button>
</div>

<!-- Change Color -->
<div class="page" id="colorPage">
  <h2>Change Background</h2>
  <p>Pick a solid color or set a gradient:</p>
  <input type="color" id="solidColor" value="#0a0f1e">
  <input type="color" id="gradientStart" value="#11376b">
  <input type="color" id="gradientEnd" value="#e46d0d">
  <div id="gradientPreview"></div>
  <button onclick="applySolid()">Apply Solid</button>
  <button onclick="applyGradient()">Apply Gradient</button>
</div>

<!-- Team Chat -->
<div class="page" id="chatPage">
  <h2>Team Chat (Password Protected)</h2>
  <input type="password" id="chatPassword" placeholder="Enter Password">
  <button id="chatSubmit" onclick="checkPassword()">Enter</button>
  <div id="chatContainer" style="display:none;">
    <iframe src="https://deadsimplechat.com/rJ02_uAhy"></iframe>
    <button class="open-chat-button" onclick="window.open('https://deadsimplechat.com/rJ02_uAhy', '_blank')">Open in new tab</button>
  </div>
</div>

<footer>
  69309 Portal BUTT OUT 69310
</footer>

<script>
// Show page
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
}

// Object Model
let objNet, objWebcamStream=null, objWebcamRunning=false, objCurrentFacing="environment", objLoop=null;
async function loadObjectModel(){ objNet=await mobilenet.load({version:2, alpha:0.75}); document.getElementById('objFile').disabled=false; document.getElementById('objStart').disabled=false; document.getElementById('objReset').disabled=false; document.getElementById('objStop').disabled=false; document.getElementById('objSwitch').disabled=false; document.getElementById('objResult').textContent="Model loaded.";}
async function loadObjectImage(event){ const img=document.getElementById('objImage'); const resEl=document.getElementById('objResult'); const spinner=document.getElementById('objSpinner'); img.src=URL.createObjectURL(event.target.files[0]); img.style.display='block'; spinner.style.display='block'; img.onload=async()=>{ const results=await objNet.classify(img); spinner.style.display='none'; showObjResults(results); URL.revokeObjectURL(img.src);}}
function showObjResults(results){ const resEl=document.getElementById('objResult'); if(results && results.length){ resEl.innerHTML=results.slice(0,3).map(r=>{ const percent=(r.probability*100).toFixed(2); return `<div>${r.className} - ${percent}%</div><div class="bar-container"><div class="bar" style="width:${percent}%">${percent}%</div></div>`; }).join(''); }else resEl.textContent="No prediction.";}
function resetObject(){ const img=document.getElementById('objImage'); const resEl=document.getElementById('objResult'); const fileInput=document.getElementById('objFile'); img.style.display='none'; img.src=''; resEl.textContent="Upload new image or start webcam."; fileInput.value='';}
async function startObjectWebcam(){ const video=document.getElementById('objWebcam'); try{ objWebcamStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:objCurrentFacing}, audio:false}); video.srcObject=objWebcamStream; await video.play(); objWebcamRunning=true; runObjWebcamLoop(); }catch(e){alert("Cannot access webcam.");}}
function stopObjectWebcam(){ objWebcamRunning=false; if(objLoop) cancelAnimationFrame(objLoop); if(objWebcamStream){ objWebcamStream.getTracks().forEach(t=>t.stop()); objWebcamStream=null;} document.getElementById('objWebcam').srcObject=null;}
let lastTs=0; const INTERVAL=500;
async function runObjWebcamLoop(ts){ if(!objWebcamRunning) return; objLoop=requestAnimationFrame(runObjWebcamLoop); if(!lastTs||ts-lastTs>=INTERVAL){ lastTs=ts; const results=await objNet.classify(document.getElementById('objWebcam')); showObjResults(results); }}
async function switchObjectCamera(){ objCurrentFacing=(objCurrentFacing==="environment")?"user":"environment"; stopObjectWebcam(); await startObjectWebcam();}

// Rock Model
const ROCK_MODEL_URL="https://teachablemachine.withgoogle.com/models/IZwfz2mDI/";
let rockModel, rockWebcam=null, rockLabelContainer, rockMaxPredictions, rockRunning=false, rockFacing="environment";
async function loadRockModel(){ if(rockModel) return; rockModel=await tmImage.load(ROCK_MODEL_URL+"model.json", ROCK_MODEL_URL+"metadata.json"); rockMaxPredictions=rockModel.getTotalClasses();}
async function loadRockImage(event){ if(!rockModel) await loadRockModel(); const file=event.target.files[0]; if(!file) return; const img=document.getElementById('rockImage'); img.src=URL.createObjectURL(file); img.style.display='block'; const predictions=await rockModel.predict(img); predictions.sort((a,b)=>b.probability-a.probability); rockLabelContainer=document.getElementById('rockLabelContainer'); rockLabelContainer.innerHTML=predictions.slice(0,3).map(p=>{ const per=(p.probability*100).toFixed(2); return `<div>${p.className} - ${per}%</div><div class="bar-container"><div class="bar" style="width:${per}%">${per}%</div></div>`;}).join('');}
async function startRockWebcam(){ if(!rockModel) await loadRockModel(); if(rockRunning) return; rockWebcam=new tmImage.Webcam(300,300,false); await rockWebcam.setup({facingMode:rockFacing}); await rockWebcam.play(); rockRunning=true; const container=document.getElementById('rockWebcamContainer'); container.innerHTML=""; container.appendChild(rockWebcam.canvas); rockLabelContainer=document.getElementById('rockLabelContainer'); rockLabelContainer.innerHTML=""; requestAnimationFrame(rockLoop);}
function stopRockWebcam(){ if(rockWebcam && rockRunning){ rockWebcam.stop(); rockRunning=false; document.getElementById('rockWebcamContainer').innerHTML=""; document.getElementById('rockLabelContainer').innerHTML="";}}
async function switchRockCamera(){ rockFacing=(rockFacing==="user")?"environment":"user"; stopRockWebcam(); await startRockWebcam();}
async function rockLoop(){ if(!rockRunning) return; rockWebcam.update(); const pred=await rockModel.predict(rockWebcam.canvas); pred.sort((a,b)=>b.probability-a.probability); for(let i=0;i<pred.length;i++){ const percent=(pred[i].probability*100).toFixed(2); const wrap=rockLabelContainer.childNodes[i]; wrap.querySelector("div").textContent=`${pred[i].className}: ${percent}%`; wrap.querySelector(".bar").style.width=percent+"%"; wrap.querySelector(".bar").textContent=percent+"%"; } requestAnimationFrame(rockLoop);}

// Color change
const preview=document.getElementById('gradientPreview');
function applySolid(){ preview.style.background=document.getElementById('solidColor').value; document.body.style.background=preview.style.background;}
function applyGradient(){ preview.style.background=`linear-gradient(90deg, ${document.getElementById('gradientStart').value}, ${document.getElementById('gradientEnd').value})`; document.body.style.background=preview.style.background;}

// Chat password
function checkPassword(){ const pw=document.getElementById('chatPassword').value; if(pw==="GOCSR"){ document.getElementById('chatContainer').style.display='block'; document.getElementById('chatSubmit').style.display='none'; document.getElementById('chatPassword').style.display='none'; }else{alert("Incorrect password!");}}

// Load models
loadObjectModel();
loadRockModel();
</script>
</body>
</html>
